# Техническое задание: Синхронизация интернет-магазина BMGBRAND с 1С

Этот документ описывает этапы реализации интеграции между сайтом на Node.js и системой 1С.

## 1. Архитектура интеграции
Обмен данными будет происходить через HTTP API. Сайт выступает в роли сервера (приемника), 1С выступает в роли клиента (отправителя).

## 2. Этапы реализации

### Этап 1: Создание API на стороне сайта
Необходимо реализовать следующие эндпоинты:
- `POST /api/sync/products` — обновление/создание товаров. Принимает массив объектов (артикул, название, цена, количество, ссылки на фото, характеристики).
- `GET /api/sync/orders` — получение списка новых заказов для выгрузки в 1С.
- `PATCH /api/sync/orders/:id` — обновление статуса заказа из 1С (например, "Передан в доставку").

### Этап 2: Безопасность
- Использование статического API-ключа, передаваемого в заголовке `X-API-KEY`.
- Ключ хранится в переменных окружения (Secrets).

### Этап 3: Обработка данных
- **Цены и остатки**: Автоматическое обновление в базе данных PostgreSQL (Drizzle ORM).
- **Изображения**:
  - На этапе разработки (Replit): хранение ссылок на внешние ресурсы или локально.
  - На этапе продакшена (Yandex Cloud): загрузка в **Yandex Object Storage (S3)** для максимальной скорости.

### Этап 4: Настройка 1С
- Специалист 1С настраивает регламентное задание для отправки данных на URL сайта.
- Формат обмена: **JSON**.

## 3. План переноса на Yandex Cloud
1. Экспорт схемы базы данных.
2. Создание инстанса Managed PostgreSQL в Yandex Cloud.
3. Развертывание кода через Docker-контейнер или Cloud Functions.
4. Перенос секретов (API-ключи, URL базы данных).
5. Смена адреса API в настройках 1С на новый домен.

---
*Документ подготовлен для согласования архитектуры перед началом разработки.*
